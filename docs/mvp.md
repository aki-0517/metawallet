# Metawallet MVP 要件定義書

## 1. プロジェクト概要

**Metawallet**は、ブロックチェーンの複雑さを抽象化し、ユーザーのアイデンティティ（`@username`）を軸にしたシームレスなマルチチェーン体験を提供する統合ウォレットアプリケーションである。

本MVP（Minimum Viable Product）では、ユーザーがメールアドレスで簡単にウォレットを作成し、SolanaとEVMチェーン（例: Ethereum）の資産を単一のUIで管理し、相手のユーザーネームを指定して簡単に送金できるコア機能の実装を目指す。さらに、Paymasterを導入することで、ユーザーはガス代を意識することなく取引を実行できるガスレス体験を実現する。

---

## 2. 技術スタック

| カテゴリ | 技術 | 目的 |
| :--- | :--- | :--- |
| **フロントエンド** | React, TypeScript, Vite | モダンで高速なWebアプリケーション開発 |
| **ブロックチェーン接続** | viem / wagmi | EVMチェーン（Sepolia）との効率的な対話 |
| | @solana/kit | Solanaブロックチェーン（Devnet）との対話 |
| **ウォレット/認証** | Web3Auth (MetaMask Embedded Wallet) | メールアドレスによるノンカストディアルウォレット生成と管理 |
| **スタイリング** | Tailwind CSS | 迅速なUI開発 |
| **ネームサービス** | ENS, SNS | ユーザーネームの一意性検証とアドレス解決 |

---

## 3. ターゲットユーザー

* 暗号資産やブロックチェーンに詳しくないが、日常使いする一般ユーザー。
* 複数のチェーンの資産を簡単に管理したいと考えているライトな暗号資産ユーザー。

---

## 4. 機能要件（ユーザーストーリー形式）

### Epic: ユーザーオンボーディング

| ID | ユーザーストーリー | 受け入れ条件 | 優先度 |
| :--- | :--- | :--- | :--- |
| **F-01** | **ユーザーとして、メールアドレスだけでサインアップ/ログインしたい** | 1. トップページに「メールでサインアップ/ログイン」ボタンが存在する。<br>2. Web3Authのモーダルが表示され、メールアドレスを入力できる。<br>3. 認証後、アプリケーションにログインでき、バックグラウンドでEVMとSolanaのウォレットが生成されている。 | **High** |
| **F-02** | **初回ログイン時に、一意の`@username`を設定したい** | 1. 初回ログイン後、ユーザーネーム入力画面に遷移する。<br>2. 入力されたユーザーネームがENSとSNSで利用可能かどうかがリアルタイムで検証される。<br>3. 利用不可能な場合はエラーメッセージが表示される。<br>4. 利用可能なユーザーネームを登録すると、ダッシュボード画面に遷移する。 | **High** |

### Epic: ダッシュボードと資産管理

| ID | ユーザーストーリー | 受け入れ条件 | 優先度 |
| :--- | :--- | :--- | :--- |
| **F-03** | **ダッシュボードで、全チェーンの資産合計額をUSDで確認したい** | 1. ダッシュボードの目立つ位置に、合算された総資産額がUSDで表示される。<br>2. MVPでは資産をUSDCとUSDTに限定し、それらの合計額を表示する。<br>3. 各チェーンの残高は非同期で取得され、ローディング状態が示される。 | **High** |
| **F-04** | **自分のウォレットアドレス（EVM/Solana）と`@username`を確認したい** | 1. ダッシュボード上に、自分の`@username`（例: `@alice`）が表示されている。<br>2. アドレスを確認できるボタンまたはアコーディオンメニューが存在する。<br>3. ボタンをクリックすると、EVMアドレスとSolanaアドレスの両方が表示され、コピーできる。 | **Medium** |

### Epic: 送金

| ID | ユーザーストーリー | 受け入れ条件 | 優先度 |
| :--- | :--- | :--- | :--- |
| **F-05** | **相手の`@username`を指定して、USD建てで送金したい** | 1. 「送金」画面で、送金相手の`@username`と送金額（USD）を入力できる。<br>2. 送金ボタンを押すと、確認画面が表示される。<br>3. 確認画面には、送金先、送金額、および各チェーンから送金される概算額が表示される。<br>4. ユーザーが承認すると、Web3Authの署名モーダルが表示され、比例送金のトランザクションが実行される。 | **High** |
| **F-06** | **相手のウォレットアドレスを指定して送金したい** | 1. 「送金」画面で、アドレスで送金するオプションを選択できる。<br>2. チェーン（EVM/Solana）を選択するドロップダウンが表示される。<br>3. 相手のアドレスと送金額（トークン単位）を入力できる。<br>4. 送金ボタンを押すと、Web3Authの署名モーダルが表示され、トランザクションが実行される。 | **Medium** |

---

## 5. アーキテクチャとデータフロー（ハイレベル）

1.  **ユーザー認証**:
    * ユーザーがメールアドレスを入力 → Web3Auth SDKが認証処理を実行。
    * Web3AuthがMPC（Multi-Party Computation）技術を用いて秘密鍵のシェアを生成・管理し、EVMとSolanaのウォレットをユーザーに提供する。

2.  **残高表示**:
    * フロントエンド（React）は、`viem`を使ってEVMチェーンのUSDC/USDT残高を、`@solana/kit`を使ってSolanaチェーンのUSDC/USDT残高をそれぞれ取得する。
    * 取得した残高を合算し、USD建てでUIに表示する。

3.  **比例送金フロー (`@username`指定時)**:
    * ユーザーが送金先`@username`と金額（USD）を入力。
    * フロントエンドは、ENS/SNSリゾルバを介して`@username`に対応するEVM/Solanaアドレスを取得する。
    * フロントエンドは、ユーザー自身の各チェーンの資産比率を計算する。（例: Solana 70%, EVM 30%）
    * 送金額を上記の比率で分割し、2つのトランザクション（Solanaへの送金、EVMへの送金）を生成する。
    * Web3Auth SDKを呼び出し、ユーザーに両トランザクションへの署名を要求する。
    * ユーザーが署名後、トランザクションはPaymasterサービスに送信される。Paymasterがガス代を肩代わりし、各ブロックチェーンにトランザクションをブロードキャストする。これにより、ユーザーは**ガスレス（Gas-less）**な送金体験を得る。